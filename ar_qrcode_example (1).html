<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ExperiÃªncia AR - Toque na Tela</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.2/dist/mindar-image-aframe.prod.js"></script>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            font-family: Arial, sans-serif;
        }
        
        #loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            color: white;
        }
        
        #loading h1 {
            font-size: 28px;
            margin-bottom: 20px;
            animation: pulse 2s infinite;
        }
        
        #loading p {
            font-size: 16px;
            margin: 10px 20px;
            text-align: center;
        }
        
        #startButton {
            margin-top: 30px;
            padding: 15px 40px;
            font-size: 18px;
            background: white;
            color: #667eea;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transition: transform 0.2s;
        }
        
        #startButton:active {
            transform: scale(0.95);
        }
        
        .instructions {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px 25px;
            border-radius: 15px;
            z-index: 999;
            text-align: center;
            max-width: 90%;
            animation: fadeIn 1s;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <div id="loading">
        <h1>ðŸŽ¨ ExperiÃªncia AR Interativa</h1>
        <p>âœ¨ Toque na tela para colocar objetos 3D</p>
        <p>ðŸŽ¯ Arraste para mover â€¢ PinÃ§a para zoom</p>
        <p>ðŸŽ¨ Toque nos objetos para mudar cores</p>
        <button id="startButton">INICIAR EXPERIÃŠNCIA</button>
    </div>

    <div class="instructions hidden">
        <p><strong>ðŸ‘† Toque na tela</strong> para adicionar objetos 3D</p>
    </div>

    <a-scene
        id="scene"
        embedded
        vr-mode-ui="enabled: false"
        renderer="logarithmicDepthBuffer: true; precision: medium;"
        ar-hit-test="target:#scene;"
        gesture-detector>
        
        <a-assets>
            <a-asset-item id="arrow" src="https://cdn.jsdelivr.net/gh/hiukim/mind-ar-js@1.2.2/examples/image-tracking/assets/band-example/arrow.glb"></a-asset-item>
        </a-assets>

        <a-camera gps-camera rotation-reader look-controls="enabled: false"></a-camera>
        
        <a-light type="ambient" intensity="0.5"></a-light>
        <a-light type="directional" intensity="0.8" position="1 1 1"></a-light>

    </a-scene>

    <script>
        let sceneEl = document.querySelector('a-scene');
        let objectCount = 0;
        let cameraReady = false;
        
        // Objetos disponÃ­veis para criar
        const objects = [
            { type: 'box', size: '0.2 0.2 0.2', color: '#4CC3D9' },
            { type: 'sphere', radius: '0.15', color: '#EF2D5E' },
            { type: 'cylinder', radius: '0.1', height: '0.3', color: '#FFC65D' },
            { type: 'cone', radiusBottom: '0.15', radiusTop: '0', height: '0.3', color: '#43A047' },
            { type: 'torus', radius: '0.15', radiusTubular: '0.03', color: '#F06292' }
        ];

        // BotÃ£o iniciar
        document.getElementById('startButton').addEventListener('click', async () => {
            document.getElementById('loading').classList.add('hidden');
            document.querySelector('.instructions').classList.remove('hidden');
            
            // Solicita permissÃ£o da cÃ¢mera no iOS
            if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
                try {
                    await DeviceOrientationEvent.requestPermission();
                    await DeviceMotionEvent.requestPermission();
                } catch (error) {
                    console.log('PermissÃ£o negada:', error);
                }
            }
            
            startARExperience();
        });

        function startARExperience() {
            // Inicializa WebXR para AR
            if (navigator.xr) {
                navigator.xr.isSessionSupported('immersive-ar').then((supported) => {
                    if (supported) {
                        startWebXRAR();
                    } else {
                        startBasicAR();
                    }
                }).catch(() => {
                    startBasicAR();
                });
            } else {
                startBasicAR();
            }
        }

        function startBasicAR() {
            // AR bÃ¡sico com toque na tela
            cameraReady = true;
            
            // Adiciona objetos ao tocar
            sceneEl.addEventListener('click', (event) => {
                if (event.target === sceneEl.canvas) {
                    addObject(event);
                }
            });
        }

        function startWebXRAR() {
            startBasicAR(); // Fallback para bÃ¡sico
        }

        function addObject(event) {
            // Calcula posiÃ§Ã£o na frente da cÃ¢mera
            const camera = document.querySelector('a-camera');
            const cameraPos = camera.getAttribute('position');
            const cameraRot = camera.getAttribute('rotation');
            
            // PosiÃ§Ã£o aleatÃ³ria ao redor da cÃ¢mera
            const distance = 2 + Math.random() * 2;
            const angle = (Math.random() - 0.5) * Math.PI;
            
            const x = Math.sin(angle) * distance;
            const y = cameraPos.y + (Math.random() - 0.5);
            const z = cameraPos.z - Math.cos(angle) * distance;

            // Seleciona objeto aleatÃ³rio
            const objData = objects[objectCount % objects.length];
            objectCount++;

            // Cria entidade
            const entity = document.createElement('a-entity');
            entity.setAttribute('position', `${x} ${y} ${z}`);
            
            // Cria primitiva
            const primitive = document.createElement(`a-${objData.type}`);
            
            // Define atributos baseado no tipo
            if (objData.type === 'box') {
                primitive.setAttribute('width', '0.2');
                primitive.setAttribute('height', '0.2');
                primitive.setAttribute('depth', '0.2');
            } else if (objData.type === 'sphere') {
                primitive.setAttribute('radius', objData.radius);
            } else if (objData.type === 'cylinder') {
                primitive.setAttribute('radius', objData.radius);
                primitive.setAttribute('height', objData.height);
            } else if (objData.type === 'cone') {
                primitive.setAttribute('radius-bottom', objData.radiusBottom);
                primitive.setAttribute('radius-top', objData.radiusTop);
                primitive.setAttribute('height', objData.height);
            } else if (objData.type === 'torus') {
                primitive.setAttribute('radius', objData.radius);
                primitive.setAttribute('radius-tubular', objData.radiusTubular);
            }
            
            primitive.setAttribute('color', objData.color);
            primitive.setAttribute('class', 'clickable');
            
            // AnimaÃ§Ãµes
            primitive.setAttribute('animation', {
                property: 'rotation',
                to: '0 360 0',
                loop: true,
                dur: 4000,
                easing: 'linear'
            });
            
            primitive.setAttribute('animation__float', {
                property: 'position',
                to: `0 0.2 0`,
                dir: 'alternate',
                loop: true,
                dur: 2000,
                easing: 'easeInOutSine'
            });

            entity.appendChild(primitive);
            sceneEl.appendChild(entity);
            
            // Interatividade
            primitive.addEventListener('click', function(e) {
                e.stopPropagation();
                const colors = ['#4CC3D9', '#EF2D5E', '#FFC65D', '#43A047', '#F06292', '#9C27B0', '#FF5722'];
                const newColor = colors[Math.floor(Math.random() * colors.length)];
                this.setAttribute('color', newColor);
                
                // AnimaÃ§Ã£o de escala
                this.setAttribute('animation__scale', {
                    property: 'scale',
                    to: '1.3 1.3 1.3',
                    dur: 200,
                    dir: 'alternate',
                    loop: 1
                });
            });

            // Mostra feedback
            showNotification(`Objeto ${objectCount} adicionado!`);
        }

        function showNotification(message) {
            const notification = document.createElement('div');
            notification.style.position = 'fixed';
            notification.style.top = '20px';
            notification.style.left = '50%';
            notification.style.transform = 'translateX(-50%)';
            notification.style.background = 'rgba(0,0,0,0.8)';
            notification.style.color = 'white';
            notification.style.padding = '10px 20px';
            notification.style.borderRadius = '20px';
            notification.style.zIndex = '9999';
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.transition = 'opacity 0.5s';
                notification.style.opacity = '0';
                setTimeout(() => notification.remove(), 500);
            }, 2000);
        }

        // Gesture detector para iOS
        AFRAME.registerComponent('gesture-detector', {
            init: function() {
                this.handleTouchStart = this.handleTouchStart.bind(this);
                this.handleTouchEnd = this.handleTouchEnd.bind(this);
                
                this.el.addEventListener('touchstart', this.handleTouchStart);
                this.el.addEventListener('touchend', this.handleTouchEnd);
            },
            
            handleTouchStart: function(e) {
                this.startX = e.touches[0].clientX;
                this.startY = e.touches[0].clientY;
            },
            
            handleTouchEnd: function(e) {
                const deltaX = Math.abs(e.changedTouches[0].clientX - this.startX);
                const deltaY = Math.abs(e.changedTouches[0].clientY - this.startY);
                
                if (deltaX < 10 && deltaY < 10) {
                    // Simula click
                    const event = new MouseEvent('click', {
                        bubbles: true,
                        cancelable: true,
                        view: window
                    });
                    e.target.dispatchEvent(event);
                }
            }
        });
    </script>
</body>
</html>